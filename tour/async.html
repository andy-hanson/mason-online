<!DOCTYPE html><html><head><title>tour/async - mason programming language</title><meta charset="utf-8"><meta name="description" content="Mason is a new programming language compiling to JavaScript. It runs on the web and in node.js."><link rel="icon" href="/icon.svg"><!-- ID needed because mason-editor.js is not run inside of this.--><link id="link-mason-editor" rel="import" href="/mason-editor"><!-- I'd like to include this in mason-editor.jade, but RequireJS won't let me.--><link rel="stylesheet" href="/style/layout.css"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga')
ga('create', 'UA-66651880-1', 'auto')
ga('send', 'pageview')
</script><script src="/lib/requirejs/require.js"></script><script>requirejs.config({
	baseUrl: '/lib',
	paths: {
		marked: 'marked/marked.min',
		msl: 'msl/dist',
		'mason-compile': 'mason-compile/dist'
	}
})
// kludge: need to require bootstrap because mason modules lazily load using _ms
require(['msl/private/bootstrap'], () =>
	require(['../script/mason-editor/mason-editor']), err => { throw err })
</script></head><body><header><h1><a href="/">mason</a></h1><nav><a href="basic">basic</a><a href="=">=</a><a href="if">if</a><a href="try">try</a><a href="class">class</a><a href="type">type</a><a href="misc">misc</a><a href="for">for</a><a href="yield">yield</a><a href="async">async</a><a href="doc">doc</a></nav></header><main><section><p>Async functions run asynchronously, consuming
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promises</a> and returning one too.</p><p>Just use <code>$|</code> instead of <code>*|</code>. <span class="aside">Generators are never async.</span></p><p>Await a promise using <code>$</code>. This allows you to write asynchronous code without higher-order functions.</p><div class="aside">These are based on a future JS
<a href="https://tc39.github.io/ecmascript-asyncawait/">feature</a>.
</div></section><mason-editor><pre>import
	global fetch

$fetch-text = $|url
	response = $ fetch url
	$ response.text()

$fetch-text "./fetch-me.txt"
</pre></mason-editor><section><p>These are actually compiled to generators with a simple wrapper around them.</p><p>That's the awesome power of generators!</p></section><a href="/tour/async#$for"><h1 id="$for">$for</h1></a><section><p><code>$for</code> is just like a <a href="./for">for</a> that runs all iterations together concurrently, rather than one-by-one.</p><div class="aside">It's concurrent, but not parallel unless you use <a href="//developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API">web workers</a>.</div><p>The value of the <code>$for</code> is a Promise for an Array of the results of each iteration.</p><p>It essentially compiles to <code>Promise.all (@map @coll for-body)</code>.
So, you must always provide a collection to iterate over, and <code>break</code> is forbidden.
</p></section><mason-editor><pre>import
	global fetch

$for ["./fetch-me.txt" "./fetch-me-too.txt"]
	$ ($ fetch_).text()
</pre></mason-editor><section><p><code>$for</code> can appear as a statement inside <code>$|</code>.</p><p>In statement context, is automatically awaited <span class="aside">equivalent to <code>$ $for ...</code></span>.</p></section><mason-editor><pre>import
	global fetch

$fetch-map = $|urls
	with empty Map as map
		$for url of urls
			map[url] = $ ($ fetch url).text()

$fetch-map ["./fetch-me.txt" "./fetch-me-too.txt"]</pre></mason-editor></main><footer><div id="prev" class="prev-next"><a href="yield">yield</a></div><div id="middle"><ul><li>public domain</li><li><a href="//github.com/mason-lang"><i class="fa fa-github"></i></a></li><li><a href="//andy-hanson.me">author</a></li></ul></div><div id="next" class="prev-next"><a href="doc">doc</a></div></footer></body></html>