{"version":3,"sources":["private/verify/SK.js"],"names":[],"mappings":"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","file":"private/verify/SK.js","sourcesContent":["(function (factory) {\n    if (typeof module === 'object' && typeof module.exports === 'object') {\n        var v = factory(require, exports); if (v !== undefined) module.exports = v;\n    }\n    else if (typeof define === 'function' && define.amd) {\n        define([\"require\", \"exports\", 'op/Op', '../ast/Block', '../ast/booleans', '../ast/Case', '../ast/errors', '../ast/LineContent', '../ast/Loop', '../ast/Switch', '../ast/With', '../context', '../util', './autoBlockKind'], factory);\n    }\n})(function (require, exports) {\n    \"use strict\";\n    const Op_1 = require('op/Op');\n    const Block_1 = require('../ast/Block');\n    const booleans_1 = require('../ast/booleans');\n    const Case_1 = require('../ast/Case');\n    const errors_1 = require('../ast/errors');\n    const LineContent_1 = require('../ast/LineContent');\n    const Loop_1 = require('../ast/Loop');\n    const Switch_1 = require('../ast/Switch');\n    const With_1 = require('../ast/With');\n    const context_1 = require('../context');\n    const util_1 = require('../util');\n    const autoBlockKind_1 = require('./autoBlockKind');\n    function getBlockSK(_) {\n        return Op_1.orDefault(opBlockSK(_), () => 1);\n    }\n    exports.getBlockSK = getBlockSK;\n    function getLineSK(_) {\n        return Op_1.orDefault(opSK(_), () => 1);\n    }\n    exports.getLineSK = getLineSK;\n    function opBlockSK({ lines, loc }) {\n        return autoBlockKind_1.default(lines, loc) === 2 ?\n            util_1.isEmpty(lines) ? 0 : opSK(util_1.last(lines)) :\n            1;\n    }\n    function opSK(_) {\n        if (_ instanceof LineContent_1.DoOnly)\n            return 0;\n        else if (_ instanceof LineContent_1.ValOnly)\n            return 1;\n        else if (_ instanceof booleans_1.Conditional) {\n            const { result } = _;\n            return result instanceof Block_1.default ? opBlockSK(result) : opSK(result);\n        }\n        else if (_ instanceof errors_1.Except) {\n            const { loc, tried, allCatches, opElse } = _;\n            const catches = allCatches.map((_) => _.block);\n            const parts = Op_1.caseOp(opElse, _ => util_1.cat(_, catches), () => util_1.cat(tried, catches));\n            return compositeSK(loc, parts.map(opBlockSK));\n        }\n        else if (_ instanceof Loop_1.For)\n            return Op_1.orDefault(opForSKBlock(_.block), () => 0);\n        else if (_ instanceof Case_1.default || _ instanceof Switch_1.default)\n            return compositeSK(_.loc, caseSwitchParts(_).map(opBlockSK));\n        else\n            return null;\n    }\n    function opForSKBlock({ loc, lines }) {\n        return util_1.isEmpty(lines) ? null : compositeForSK(loc, lines.map(opForSK));\n    }\n    function opForSK(_) {\n        if (_ instanceof Loop_1.Break)\n            return _.opValue === null ? 0 : 1;\n        else if (_ instanceof booleans_1.Conditional) {\n            const { result } = _;\n            return result instanceof Block_1.default ? opForSKBlock(result) : opForSK(result);\n        }\n        else if (_ instanceof errors_1.Except) {\n            const { loc, tried, allCatches, opElse, opFinally } = _;\n            const catches = allCatches.map(_ => _.block);\n            return compositeForSK(loc, util_1.cat(tried, catches, opElse, opFinally).map(opForSKBlock));\n        }\n        else if (_ instanceof With_1.default)\n            return opForSKBlock(_.block);\n        else if (_ instanceof Case_1.default || _ instanceof Switch_1.default)\n            return compositeForSK(_.loc, caseSwitchParts(_).map(opForSKBlock));\n        else\n            return null;\n    }\n    function caseSwitchParts({ parts, opElse }) {\n        return util_1.cat(parts.map(_ => _.result), opElse);\n    }\n    function compositeSK(loc, parts) {\n        return composite(loc, parts, _ => _.ambiguousSK);\n    }\n    function compositeForSK(loc, parts) {\n        return composite(loc, parts, _ => _.ambiguousForSK);\n    }\n    function composite(loc, sks, errorMessage) {\n        let opSk = sks[0];\n        for (let i = 1; i < sks.length; i = i + 1) {\n            const otherSK = sks[i];\n            if (opSk === null)\n                opSk = otherSK;\n            else\n                context_1.check(otherSK === null || otherSK === opSk, loc, errorMessage);\n        }\n        return opSk;\n    }\n});\n"],"sourceRoot":"/source/"}