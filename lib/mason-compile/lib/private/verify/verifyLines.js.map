{"version":3,"sources":["private/verify/verifyLines.js"],"names":[],"mappings":"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","file":"private/verify/verifyLines.js","sourcesContent":["(function (factory) {\n    if (typeof module === 'object' && typeof module.exports === 'object') {\n        var v = factory(require, exports); if (v !== undefined) module.exports = v;\n    }\n    else if (typeof define === 'function' && define.amd) {\n        define([\"require\", \"exports\", '../ast/BuildEntry', '../ast/locals', '../context', '../util', './context', './verifyDo', './verifyLocals'], factory);\n    }\n})(function (require, exports) {\n    \"use strict\";\n    const BuildEntry_1 = require('../ast/BuildEntry');\n    const locals_1 = require('../ast/locals');\n    const context_1 = require('../context');\n    const util_1 = require('../util');\n    const context_2 = require('./context');\n    const verifyDo_1 = require('./verifyDo');\n    const verifyLocals_1 = require('./verifyLocals');\n    function verifyLines(lines) {\n        const newLocals = [];\n        for (const line of util_1.reverseIter(lines))\n            for (const _ of util_1.reverseIter(lineNewLocals(line))) {\n                verifyLocals_1.registerLocal(_);\n                newLocals.push(_);\n            }\n        context_2.pendingBlockLocals.push(...newLocals);\n        const thisBlockLocalNames = new Set();\n        const shadowed = [];\n        for (const line of lines) {\n            verifyDo_1.ensureDoAndVerify(line);\n            for (const newLocal of lineNewLocals(line)) {\n                const { name, loc } = newLocal;\n                const oldLocal = context_2.locals.get(name);\n                if (oldLocal !== undefined) {\n                    context_1.check(!thisBlockLocalNames.has(name), loc, _ => _.duplicateLocal(name));\n                    shadowed.push(oldLocal);\n                }\n                thisBlockLocalNames.add(name);\n                verifyLocals_1.setLocal(newLocal);\n                const popped = context_2.pendingBlockLocals.pop();\n                util_1.assert(popped === newLocal);\n            }\n        }\n        newLocals.forEach(verifyLocals_1.deleteLocal);\n        shadowed.forEach(verifyLocals_1.setLocal);\n        return newLocals;\n    }\n    Object.defineProperty(exports, \"__esModule\", { value: true });\n    exports.default = verifyLines;\n    function verifyBuiltLines(lines, loc) {\n        verifyLocals_1.verifyAndPlusLocal(locals_1.LocalDeclare.built(loc), () => {\n            verifyLines(lines);\n        });\n    }\n    exports.verifyBuiltLines = verifyBuiltLines;\n    function lineNewLocals(line) {\n        return line instanceof locals_1.AssignSingle ?\n            [line.assignee] :\n            line instanceof locals_1.AssignDestructure ?\n                line.assignees :\n                line instanceof BuildEntry_1.ObjEntryAssign ?\n                    lineNewLocals(line.assign) :\n                    [];\n    }\n});\n"],"sourceRoot":"/source/"}