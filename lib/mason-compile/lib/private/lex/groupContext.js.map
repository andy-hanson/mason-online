{"version":3,"sources":["private/lex/groupContext.js"],"names":[],"mappings":"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","file":"private/lex/groupContext.js","sourcesContent":["(function (factory) {\n    if (typeof module === 'object' && typeof module.exports === 'object') {\n        var v = factory(require, exports); if (v !== undefined) module.exports = v;\n    }\n    else if (typeof define === 'function' && define.amd) {\n        define([\"require\", \"exports\", 'esast/lib/Loc', '../context', '../token/Group', '../util'], factory);\n    }\n})(function (require, exports) {\n    \"use strict\";\n    const Loc_1 = require('esast/lib/Loc');\n    const context_1 = require('../context');\n    const Group_1 = require('../token/Group');\n    const util_1 = require('../util');\n    let groupStack;\n    function setupGroupContext() {\n        exports.curGroup = new Group_1.GroupBlock(new Loc_1.default(Loc_1.Pos.start, null), []);\n        groupStack = [];\n    }\n    exports.setupGroupContext = setupGroupContext;\n    function tearDownGroupContext(endPos) {\n        closeLine(endPos);\n        util_1.assert(util_1.isEmpty(groupStack));\n        exports.curGroup.loc.end = endPos;\n        const res = exports.curGroup;\n        groupStack = exports.curGroup = null;\n        return res;\n    }\n    exports.tearDownGroupContext = tearDownGroupContext;\n    function addToCurrentGroup(token) {\n        exports.curGroup.subTokens.push(token);\n    }\n    exports.addToCurrentGroup = addToCurrentGroup;\n    function dropGroup() {\n        exports.curGroup = groupStack.pop();\n    }\n    function openGroup(openPos, groupType) {\n        groupStack.push(exports.curGroup);\n        exports.curGroup = new groupType(new Loc_1.default(openPos, null), []);\n    }\n    exports.openGroup = openGroup;\n    function maybeCloseGroup(closePos, closeType) {\n        if (exports.curGroup instanceof closeType)\n            closeGroupNoCheck(closePos, closeType);\n    }\n    exports.maybeCloseGroup = maybeCloseGroup;\n    function closeGroup(closePos, closeType) {\n        context_1.check(exports.curGroup instanceof closeType, closePos, _ => _.mismatchedGroupClose(closeType, exports.curGroup));\n        closeGroupNoCheck(closePos, closeType);\n    }\n    exports.closeGroup = closeGroup;\n    function closeGroupNoCheck(closePos, closeType) {\n        const justClosed = exports.curGroup;\n        dropGroup();\n        justClosed.loc.end = closePos;\n        switch (closeType) {\n            case Group_1.GroupSpace: {\n                const size = justClosed.subTokens.length;\n                if (size === 0)\n                    context_1.warn(justClosed.loc, _ => _.extraSpace);\n                else\n                    addToCurrentGroup(size === 1 ? justClosed.subTokens[0] : justClosed);\n                break;\n            }\n            case Group_1.GroupLine:\n                if (!util_1.isEmpty(justClosed.subTokens))\n                    addToCurrentGroup(justClosed);\n                break;\n            case Group_1.GroupBlock:\n                context_1.check(!util_1.isEmpty(justClosed.subTokens), closePos, _ => _.emptyBlock);\n                addToCurrentGroup(justClosed);\n                break;\n            default:\n                addToCurrentGroup(justClosed);\n        }\n    }\n    function closeSpaceOKIfEmpty(pos) {\n        util_1.assert(exports.curGroup instanceof Group_1.GroupSpace);\n        if (exports.curGroup.subTokens.length === 0)\n            dropGroup();\n        else\n            closeGroupNoCheck(pos, Group_1.GroupSpace);\n    }\n    exports.closeSpaceOKIfEmpty = closeSpaceOKIfEmpty;\n    function openInterpolation(loc) {\n        openGroup(loc.start, Group_1.GroupInterpolation);\n        openGroup(loc.end, Group_1.GroupSpace);\n    }\n    exports.openInterpolation = openInterpolation;\n    function closeInterpolationOrParenthesis(loc) {\n        closeGroupNoCheck(loc.start, Group_1.GroupSpace);\n        const group = exports.curGroup;\n        closeGroupNoCheck(loc.end, group.type);\n        return group instanceof Group_1.GroupInterpolation;\n    }\n    exports.closeInterpolationOrParenthesis = closeInterpolationOrParenthesis;\n    function closeInterpolation(loc) {\n        closeGroupNoCheck(loc.start, Group_1.GroupSpace);\n        closeGroup(loc.end, Group_1.GroupInterpolation);\n    }\n    exports.closeInterpolation = closeInterpolation;\n    function closeGroupsForDedent(pos) {\n        closeLine(pos);\n        closeGroup(pos, Group_1.GroupBlock);\n        while (exports.curGroup instanceof Group_1.GroupParenthesis || exports.curGroup instanceof Group_1.GroupSpace)\n            closeGroupNoCheck(pos, exports.curGroup.type);\n    }\n    exports.closeGroupsForDedent = closeGroupsForDedent;\n    function openLine(pos) {\n        openGroup(pos, Group_1.GroupLine);\n        openGroup(pos, Group_1.GroupSpace);\n    }\n    exports.openLine = openLine;\n    function closeLine(pos) {\n        if (exports.curGroup instanceof Group_1.GroupSpace)\n            closeSpaceOKIfEmpty(pos);\n        closeGroup(pos, Group_1.GroupLine);\n    }\n    exports.closeLine = closeLine;\n    function space(loc) {\n        maybeCloseGroup(loc.start, Group_1.GroupSpace);\n        openGroup(loc.end, Group_1.GroupSpace);\n    }\n    exports.space = space;\n});\n"],"sourceRoot":"/source/"}